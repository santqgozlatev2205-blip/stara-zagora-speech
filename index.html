<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bus Speech</title>

<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
.header{display:flex}
.line{background:#0a7d13;font-size:42px;padding:10px 18px}
.dir{flex:1;overflow:hidden;white-space:nowrap;padding:18px;
animation:scroll 18s linear infinite}
@keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-100%)}}

.info{text-align:center;font-size:22px;margin:10px}
.time{text-align:center;font-size:16px;opacity:.7}

select{width:95%;margin:10px;font-size:18px;background:#000;color:#fff}
option.end{color:orange}

ul{list-style:none;padding:0}
li{padding:6px 12px;border-bottom:1px solid #222}
.current{color:#ff4d4d}
.next{color:#6bff6b}
.end{color:orange}

button{width:95%;padding:10px;margin:10px;font-size:18px}

#popup{
position:fixed;bottom:20px;left:50%;
transform:translateX(-50%);
background:#ff9800;color:#000;
padding:15px;border-radius:10px;
font-size:14px;text-align:center;
display:none;max-width:90%;
}
</style>
</head>

<body>

<div class="header">
 <div class="line">71</div>
 <div class="dir">–∫–≤. –ó–æ—Ä–∞ ‚Äì –∫–≤. –ñ–µ–ª–µ–∑–Ω–∏–∫ –ø—Ä–µ–∑ –°—Ç–∞–¥–∏–æ–Ω –ë–µ—Ä–æ–µ</div>
</div>

<button id="audioBtn">üîä –í–∫–ª—é—á–∏ –∑–≤—É–∫</button>

<div class="info" id="label">–°–ø–∏—Ä–∫–∞ / Bus stop</div>
<div class="info" id="currentStop"></div>

<select id="endSelect"></select>
<ul id="route"></ul>

<div class="time" id="time"></div>
<div id="popup"></div>

<script>
const stops=[
{name:"–ó–æ—Ä–∞ - –û–±—Ä—ä—â–∞–ª–æ",lat:42.424226,lon:25.68831,file:"zora_obrushtalo"},
{name:"–ó–æ—Ä–∞ - 2",lat:42.4265,lon:25.6875,file:"zora_2"},
{name:"–ó–æ—Ä–∞ - 1",lat:42.4281,lon:25.686,file:"zora_1"},
{name:"–ú–µ—Ç—Ä–æ –ó–æ—Ä–∞",lat:42.43087,lon:25.68417,file:"metro_zora"},
{name:"–°–ø–∏—Ä–∫–∞",lat:42.4315,lon:25.683,file:"spirka"},
{name:"–°–ë–ê",lat:42.432,lon:25.682,file:"sba"},
{name:"–°–ø–æ—Ä—Ç–Ω–∞ –∑–∞–ª–∞",lat:42.428153,lon:25.658405,file:"sportna_zala"},
{name:"–°—Ç–∞–¥–∏–æ–Ω –ë–µ—Ä–æ–µ",lat:42.431219,lon:25.617108,file:"stadion_beroe"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ - –û–±—Ä—ä—â–∞–ª–æ",lat:42.410706,lon:25.592148,file:"jheleznik_obrushtalo"}
];

const STOP_R=0.00009, NEXT_R=0.000045;
let cur=0, end=stops.length-1;
let audio=false, stopDone=false, nextDone=false;
let popupInt=null, popupLang=true;

const popup=document.getElementById("popup");

function playSeq(arr){
 let i=0; const a=new Audio(arr[0]);
 a.onended=()=>{i++; if(i<arr.length){a.src=arr[i];a.play();}};
 a.play();
}

document.getElementById("audioBtn").onclick=()=>{
 audio=true;
 playSeq(["line.mp3","71.mp3","direction.mp3","zora_jheleznik_stadion_beroe.mp3"]);
};

function showPopup(){
 popup.style.display="block";
 popupInt=setInterval(()=>{
  popup.textContent=popupLang
   ?"–°–õ–ï–î–í–ê–©–ê–¢–ê –°–ü–ò–†–ö–ê –ï –í–ê–®–ê–¢–ê. –ú–û–õ–Ø –°–ò–ì–ù–ê–õ–ò–ó–ò–†–ê–ô–¢–ï –ù–ê –®–û–§–¨–û–†–ê –° –ë–£–¢–û–ù ‚Äû–°–¢–û–ü‚Äú –ò–õ–ò ‚Äû–í–†–ê–¢–ê‚Äú."
   :"THE NEXT STOP IS YOURS. PLEASE SIGNAL THE DRIVER USING THE STOP OR DOOR BUTTON.";
  popupLang=!popupLang;
 },7000);
}

function hidePopup(){
 clearInterval(popupInt);
 popup.style.display="none";
}

function render(){
 const ul=document.getElementById("route");
 const sel=document.getElementById("endSelect");
 ul.innerHTML=""; sel.innerHTML="";
 for(let i=cur;i<stops.length;i++){
  const li=document.createElement("li");
  li.textContent=stops[i].name;
  if(i===cur)li.className="current";
  if(i===cur+1)li.className="next";
  if(i===end)li.className="end";
  ul.appendChild(li);

  const o=document.createElement("option");
  o.value=i;o.textContent=stops[i].name;
  if(i===end)o.className="end";
  sel.appendChild(o);
 }
 document.getElementById("currentStop").textContent=stops[cur].name;
}

document.getElementById("endSelect").onchange=e=>{
 end=+e.target.value;
 render();
};

render();

navigator.geolocation.watchPosition(pos=>{
 const h={lat:pos.coords.latitude,lon:pos.coords.longitude};

 const dStop=Math.hypot(h.lat-stops[cur].lat,h.lon-stops[cur].lon);
 if(dStop<STOP_R && !stopDone){
  stopDone=true; nextDone=false;
  if(audio){
   const seq=["stop.mp3",stops[cur].file+".mp3"];
   if(cur===end)seq.push("your_stop.mp3");
   playSeq(seq);
  }
  hidePopup();
 }

 const n=cur+1;
 if(n<=end){
  const dNext=Math.hypot(h.lat-stops[n].lat,h.lon-stops[n].lon);
  if(dNext<NEXT_R && !nextDone){
   nextDone=true;
   const seq=["next_stop.mp3",stops[n].file+".mp3"];
   if(n===end){seq.push("your_stop.mp3"); showPopup();}
   if(audio)playSeq(seq);
   cur=n; stopDone=false;
   render();
  }
 }
},{},{enableHighAccuracy:true});

setInterval(()=>{
 document.getElementById("time").textContent=
 new Date().toLocaleString("bg-BG",{weekday:"long",day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});
},1000);
</script>

</body>
</html>










