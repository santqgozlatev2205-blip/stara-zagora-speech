<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STARA ZAGORA SPEECH BY KIRIL KIRILOV</title>

<style>
body{margin:0;font-family:Arial;background:#000;color:#fff}
.header{display:flex;align-items:center;height:70px;overflow:hidden}
.line{background:#0a7d13;color:#fff;font-size:42px;font-weight:bold;
padding:0 18px;height:100%;display:flex;align-items:center;flex-shrink:0}
.dirWrap{flex:1;overflow:hidden;position:relative;height:100%}
.dir{position:absolute;white-space:nowrap;font-size:20px;line-height:70px;
padding-left:100%;animation:scroll 20s linear infinite}
@keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-100%)}}

button{width:95%;margin:10px;padding:12px;font-size:18px}
.info{text-align:center;font-size:22px;margin:8px}
select{width:95%;margin:10px;font-size:18px;background:#000;color:#fff}

ul{list-style:none;padding:0;margin:0}
li{padding:8px 14px;border-bottom:1px solid #222}
.current{color:#ff4d4d}
.next{color:#6bff6b}
.end{color:orange}

#popup{
position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
background:#ff9800;color:#000;padding:14px;border-radius:10px;
font-size:14px;text-align:center;display:none;max-width:90%;
}

.time{text-align:center;font-size:15px;opacity:.7;margin:10px}
</style>
</head>

<body>

<div class="header">
  <div class="line">71</div>
  <div class="dirWrap">
    <div class="dir">–∫–≤. –ó–æ—Ä–∞ ‚Äì –∫–≤. –ñ–µ–ª–µ–∑–Ω–∏–∫ –ø—Ä–µ–∑ –°—Ç–∞–¥–∏–æ–Ω –ë–µ—Ä–æ–µ</div>
  </div>
</div>

<button id="audioBtn">üîä –í–∫–ª—é—á–∏ –∑–≤—É–∫</button>

<div class="info" id="label">–°–ø–∏—Ä–∫–∞ / Bus stop</div>
<div class="info" id="currentStop"></div>

<select id="endSelect"></select>
<ul id="route"></ul>

<div class="time" id="time"></div>
<div id="popup"></div>

<script>
/* ===== –°–ü–ò–†–ö–ò (26) ===== */
const stops=[
{name:"–ó–æ—Ä–∞ - –û–±—Ä—ä—â–∞–ª–æ",lat:42.424226,lon:25.68831,file:"zora_obrushtalo"},
{name:"–ó–æ—Ä–∞ - 2",lat:42.4265,lon:25.6875,file:"zora_2"},
{name:"–ó–æ—Ä–∞ - 1",lat:42.4281,lon:25.686,file:"zora_1"},
{name:"–ú–µ—Ç—Ä–æ –ó–æ—Ä–∞",lat:42.43087,lon:25.68417,file:"metro_zora"},
{name:"–°–ø–∏—Ä–∫–∞",lat:42.4315,lon:25.683,file:"spirka"},
{name:"–°–ë–ê",lat:42.432,lon:25.682,file:"sba"},
{name:"–°–ø–æ—Ä—Ç–Ω–∞ –∑–∞–ª–∞",lat:42.428153,lon:25.658405,file:"sportna_zala"},
{name:"–î–ó–£",lat:42.427892,lon:25.653642,file:"dzu"},
{name:"–ö—Ä–∞–π—Ä–µ—á–µ–Ω –∏–∑—Ç–æ–∫",lat:42.431329,lon:25.643576,file:"krairechen_iztok"},
{name:"–¢–µ—Ö–Ω–∏–∫—É–º–∏ —Å–µ–≤–µ—Ä",lat:42.431909,lon:25.640756,file:"tehnikumi_sever"},
{name:"–ö–∞—É—Ñ–ª–∞–Ω–¥ –ë–µ–¥–µ—á–∫–∞ –∏–∑—Ç–æ–∫",lat:42.434173,lon:25.637058,file:"kaufland_bedechka_iztok"},
{name:"–ü–ó –ó–∞–≥–æ—Ä–∫–∞ –∑–∞–ø–∞–¥",lat:42.441585,lon:25.633277,file:"pz_zagorka_zapad"},
{name:"–ú–æ–ª –ì–∞–ª–µ—Ä–∏—è",lat:42.43812,lon:25.631661,file:"mol_galeria"},
{name:"–¢–î –Ω–∞ –ù–ê–ü",lat:42.434237,lon:25.628527,file:"nap"},
{name:"–ö–∏–ø–∞—Ä–∏—Å",lat:42.431285,lon:25.620854,file:"kiparis"},
{name:"–°—Ç–∞–¥–∏–æ–Ω –ë–µ—Ä–æ–µ",lat:42.431219,lon:25.617108,file:"stadion_beroe"},
{name:"–°–ø–æ—Ä—Ç–Ω–∞ 1",lat:42.428664,lon:25.616594,file:"sportna_1"},
{name:"–ú–ª–µ—á–Ω–∞ –∫—É—Ö–Ω—è",lat:42.426005,lon:25.61107,file:"mlechna_kuhnia"},
{name:"–ù–µ–æ–ª–∏—Ç–Ω–∏ –∂–∏–ª–∏—â–∞",lat:42.424834,lon:25.609599,file:"neolitni_jilishta"},
{name:"–¢—Ä–∏ —á—É—á—É—Ä–∞",lat:42.4179,lon:25.605246,file:"tri_chuchura"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ –∏–∑—Ç–æ–∫ 2",lat:42.415722,lon:25.599217,file:"jheleznik_iztok_2"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ –∏–∑—Ç–æ–∫ 1",lat:42.414581,lon:25.596919,file:"jheleznik_iztok_1"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ –†–ü–£",lat:42.412772,lon:25.592275,file:"jheleznik_rpu"},
{name:"–°–û–£ –ñ–µ–ª–µ–∑–Ω–∏–∫",lat:42.412613,lon:25.586999,file:"sou_jheleznik"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ - 2",lat:42.410353,lon:25.587765,file:"jheleznik_2"},
{name:"–ñ–µ–ª–µ–∑–Ω–∏–∫ - –û–±—Ä—ä—â–∞–ª–æ",lat:42.410706,lon:25.592148,file:"jheleznik_obrushtalo"}
];

/* ===== –ù–ê–°–¢–†–û–ô–ö–ò ===== */
const CURRENT_RADIUS = 0.00009; // ~10 –º (–ø—Ä–∏–±–ª–∏–∂–∞–≤–∞–Ω–µ)
const LEAVE_RADIUS   = 0.000045; // ~5 –º (–Ω–∞–ø—É—Å–∫–∞–Ω–µ)

let cur=0;
let end=stops.length-1;
let audioOn=false;
let stopDone=false;
let nextDone=false;
let popupTimer=null;
let popupBg=true;

const route=document.getElementById("route");
const select=document.getElementById("endSelect");
const label=document.getElementById("label");
const currentStop=document.getElementById("currentStop");
const popup=document.getElementById("popup");

/* ===== –ê–£–î–ò–û ===== */
function playSeq(arr){
 let i=0;
 const a=new Audio(arr[0]);
 a.onended=()=>{i++; if(i<arr.length){a.src=arr[i];a.play();}};
 a.play();
}

document.getElementById("audioBtn").onclick=()=>{
 if(audioOn) return;
 audioOn=true;
 playSeq([
  "line.mp3",
  "71.mp3",
  "direction.mp3",
  "zora_jheleznik_stadion_beroe.mp3"
 ]);
};

/* ===== POPUP ===== */
function showPopup(){
 popup.style.display="block";
 popupTimer=setInterval(()=>{
  popup.textContent = popupBg
   ?"–°–õ–ï–î–í–ê–©–ê–¢–ê –°–ü–ò–†–ö–ê –ï –í–ê–®–ê–¢–ê. –ú–û–õ–Ø –ù–ï –ó–ê–ë–†–ê–í–Ø–ô–¢–ï –î–ê –°–ò–ì–ù–ê–õ–ò–ó–ò–†–ê–¢–ï –ù–ê –®–û–§–¨–û–†–ê –ö–ê–¢–û –ù–ê–¢–ò–°–ù–ï–¢–ï –ë–£–¢–û–ù–ê ‚Äû–°–¢–û–ü‚Äú –ò–õ–ò ‚Äû–í–†–ê–¢–ê‚Äú."
   :"THE NEXT STOP IS YOURS. PLEASE SIGNAL THE DRIVER USING THE STOP OR DOOR BUTTON.";
  popupBg=!popupBg;
 },7000);
}

function hidePopup(){
 clearInterval(popupTimer);
 popup.style.display="none";
}

/* ===== UI ===== */
function render(){
 route.innerHTML="";
 select.innerHTML="";
 for(let i=cur;i<=end;i++){
  const li=document.createElement("li");
  li.textContent=stops[i].name;
  if(i===cur)li.className="current";
  if(i===cur+1)li.className="next";
  if(i===end)li.className="end";
  route.appendChild(li);

  const o=document.createElement("option");
  o.value=i;o.textContent=stops[i].name;
  if(i===end)o.style.color="orange";
  select.appendChild(o);
 }
 currentStop.textContent=stops[cur].name;
}

select.onchange=e=>{
 end=+e.target.value;
 render();
};

render();

/* ===== GPS –õ–û–ì–ò–ö–ê (–¢–û–ß–ù–û –ö–ê–ö–¢–û –ü–û–ò–°–ö–ê) ===== */
navigator.geolocation.watchPosition(pos=>{
 const here={lat:pos.coords.latitude,lon:pos.coords.longitude};

 // –ü—Ä–∏–±–ª–∏–∂–∞–≤–∞–Ω–µ ‚Üí —Ç–µ–∫—É—â–∞ —Å–ø–∏—Ä–∫–∞ (‚â§10 –º)
 const dCur=Math.hypot(
  here.lat-stops[cur].lat,
  here.lon-stops[cur].lon
 );

 if(dCur<=CURRENT_RADIUS && !stopDone){
  stopDone=true;
  nextDone=false;
  label.textContent="–°–ø–∏—Ä–∫–∞ / Bus stop";

  if(audioOn){
   const seq=["stop.mp3",stops[cur].file+".mp3"];
   if(cur===end) seq.push("your_stop.mp3");
   playSeq(seq);
  }
  hidePopup();
 }

 // –ù–∞–ø—É—Å–∫–∞–Ω–µ ‚Üí —Å–ª–µ–¥–≤–∞—â–∞ —Å–ø–∏—Ä–∫–∞ (‚â•5 –º —Å–ª–µ–¥ —Ç–µ–∫—É—â–∞—Ç–∞)
 if(dCur>=LEAVE_RADIUS && stopDone){
  const next=cur+1;
  if(next<=end && !nextDone){
   nextDone=true;
   cur=next;
   label.textContent="–°–ª–µ–¥–≤–∞—â–∞ —Å–ø–∏—Ä–∫–∞ / Next stop";

   if(audioOn){
    const seq=["next_stop.mp3",stops[cur].file+".mp3"];
    if(cur===end){
     seq.push("your_stop.mp3");
     showPopup();
    }
    playSeq(seq);
   }
   stopDone=false;
   render();
  }
 }
},
err=>console.warn(err.message),
{enableHighAccuracy:true});

/* ===== –î–ê–¢–ê / –ß–ê–° ===== */
setInterval(()=>{
 document.getElementById("time").textContent =
 new Date().toLocaleString("bg-BG",{
  weekday:"long",
  day:"2-digit",
  month:"2-digit",
  year:"numeric",
  hour:"2-digit",
  minute:"2-digit"
 });
},1000);
</script>

</body>
</html>













